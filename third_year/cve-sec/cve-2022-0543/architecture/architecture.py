from diagrams import Diagram, Cluster, Edge
from diagrams.onprem.client import Users
from diagrams.onprem.dns import Coredns
from diagrams.onprem.network import Nginx
from diagrams.onprem.inmemory import Redis
from diagrams.programming.framework import React, Fastapi
from diagrams.onprem.compute import Server


def main():
    with Diagram("Architecture_Lan", show=False):
        users = Users("Users")
        # coredns = Coredns("DNS")
        # loadbalancer = Nginx("Load Balancer")

        with Cluster("Frontend"):
            webserver = Nginx("Web Server")
            frontend = React("Frontend App")
            (
                users
                # >> coredns
                # >> loadbalancer
                >> frontend - Edge(label="static files", style="dashed") - webserver
            )

        with Cluster("Backend_1"):
            server_1 = Server("Server")
            api_1 = Fastapi("API")
            (
                webserver
                - Edge(label="HTTP Request")
                - api_1
                - Edge(label="Data", color="brown")
                - server_1
            )
        with Cluster("Backend_2"):
            server_2 = Server("Server")
            api_2 = Fastapi("API")
            (
                webserver
                - Edge(label="HTTP Request")
                - api_2
                - Edge(label="Data", color="brown")
                - server_2
            )

        database = Redis("Redis")

        [server_1, server_2] - Edge(label="Data", color="brown") - database


if __name__ == "__main__":
    main()
